{% extends "base.html" %}
{% block title %}All Expenses{% endblock %}
{% block content %}
<h2 class="page-title">All Expenses</h2>

<div class="card">
  <table class="expense-table">
    <thead>
      <tr><th>Description</th><th>Amount</th><th>Category</th><th>Date</th><th>Actions</th></tr>
    </thead>
    <tbody>
      {% for exp in expenses %}
      <tr>
        <td>{{ exp.description }}</td>
        <td>₹ {{ exp.amount }}</td>
        <td>{{ exp.category }}</td>
        <td>{{ exp.date }}</td>
        <td>
          <div style="display:flex;gap:8px;justify-content:center;">
  <a class="btn primary small" href="{{ url_for('edit_expense', expense_id=exp.id) }}">Edit</a>
  <button class="btn danger small" onclick="deleteExpense('{{ exp.id }}')">Delete</button>
</div>

        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<h3 class="page-sub">Category Totals</h3>
<div class="category-cards">
  {% for cat, total in totals.items() %}
  <div class="category-card">
    <h4 class="cat-heading {{ cat|lower }}">{{ cat }}</h4>
    <p class="cat-amount">₹ {{ total }}</p>
  </div>
  {% endfor %}
</div>


<script>
async function deleteExpense(id){
  if(!confirm('Delete this expense?')) return;
  const res = await fetch(`/delete_expense/${id}`, { method: 'POST' });
  const j = await res.json();
  if(j.status === 'success') location.reload();
  else alert(j.message || 'Error deleting');
}
</script>
{% endblock %}
